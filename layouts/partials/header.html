{{- $isZH := eq .Site.Language.Lang "zh-hant" -}}
{{- $home := cond $isZH "/zh-hant/" "/" -}}
{{- $posts := printf "%sposts/" $home -}}
{{- $about := printf "%sabout/" $home -}}
<header class="site-header">
  <div class="site-header-inner">
    <div class="site-brand">
      <a href="{{ $home }}">{{ .Site.Title }}</a>
    </div>

    <nav class="main-nav">
      <ul>
        <li>
          <a href="{{ $home }}" class="{{ if .IsHome }}active{{ end }}">ğŸ  {{ if $isZH }}é¦–é {{ else }}Home{{ end }}</a>
        </li>
        <li>
          <a href="{{ $posts }}" class="{{ if or (eq .Section "posts") (in .RelPermalink "/posts/") }}active{{ end }}">ğŸ“„ {{ if $isZH }}æ–‡ç« {{ else }}Posts{{ end }}</a>
        </li>
        <li>
          <a href="{{ $about }}" class="{{ if in .RelPermalink "/about/" }}active{{ end }}">â„¹ï¸ {{ if $isZH }}é—œæ–¼{{ else }}About{{ end }}</a>
        </li>
      </ul>
    </nav>

    <div class="top-action-group">
      <!-- æ¡Œé¢å³å´æŒ‰éˆ• -->
      <div class="custom-topbuttons desktop-only">
        <div class="cb-menu">
          <a class="cb-btn lang-switch" href="{{ if $isZH }}/{{ else }}/zh-hant/{{ end }}">ğŸŒ {{ if $isZH }}English{{ else }}æ¼¢èª{{ end }}</a>
          <button class="cb-btn" id="themeToggle" type="button">ğŸŒ“ {{ if $isZH }}æ·±è‰²æ¨¡å¼{{ else }}Dark Mode{{ end }}</button>
        </div>
      </div>

      <!-- æ‰‹æ©Ÿæ¼¢å ¡ -->
      <button class="cb-toggle mobile-only" aria-label="Menu" onclick="document.getElementById('mobileMenu').classList.toggle('open')">â˜°</button>
      <div id="mobileMenu" class="cb-menu mobile-only">
        <a class="cb-btn" href="{{ $home }}">ğŸ  {{ if $isZH }}é¦–é {{ else }}Home{{ end }}</a>
        <a class="cb-btn" href="{{ $posts }}">ğŸ“„ {{ if $isZH }}æ–‡ç« {{ else }}Posts{{ end }}</a>
        <a class="cb-btn" href="{{ $about }}">â„¹ï¸ {{ if $isZH }}é—œæ–¼{{ else }}About{{ end }}</a>
        <a class="cb-btn lang-switch" href="{{ if $isZH }}/{{ else }}/zh-hant/{{ end }}">ğŸŒ {{ if $isZH }}English{{ else }}æ¼¢èª{{ end }}</a>
        <button class="cb-btn" type="button" id="themeToggleMobile">ğŸŒ“ {{ if $isZH }}é»‘æš—{{ else }}Dark Mode{{ end }}</button>
      </div>
    </div>
  </div>
</header>

<script>
(function(){
  const root = document.documentElement;
  const body = document.body;
  const isZH = (root.lang||'').toLowerCase().startsWith('zh');
  const KEY = 'site-theme';
  const btnDesktop = document.getElementById('themeToggle');
  const btnMobile  = document.getElementById('themeToggleMobile');

  function sysPref(){
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  function setLabels(current){
    // é¡¯ç¤ºã€Œå³å°‡åˆ‡æ›åˆ°ã€çš„æ¨¡å¼
    const next = current === 'dark' ? 'light' : 'dark';
    const zhNext = next === 'dark' ? 'é»‘æš—' : 'æ˜äº®';          // â† ä¸­æ–‡ç”¨ã€Œé»‘æš— / æ˜äº®ã€
    const enNext = next === 'dark' ? 'Dark Mode' : 'Light Mode';
    const txt = isZH
      ? (next === 'dark' ? 'ğŸŒ“ ' + zhNext : 'ğŸŒ ' + zhNext)
      : (next === 'dark' ? 'ğŸŒ“ ' + enNext : 'ğŸŒ ' + enNext);
    if (btnDesktop) btnDesktop.textContent = txt;
    if (btnMobile)  btnMobile.textContent  = txt;
  }

  function apply(mode){
    if(mode === 'dark'){
      root.classList.add('dark');
      body.classList.add('dark');
    }else{
      root.classList.remove('dark');
      body.classList.remove('dark');
    }
    setLabels(mode);
  }

  apply(localStorage.getItem(KEY) || sysPref());

  function toggleTheme(){
    const target = root.classList.contains('dark') ? 'light' : 'dark';
    apply(target);
    localStorage.setItem(KEY, target);
  }

  if(btnDesktop) btnDesktop.addEventListener('click', toggleTheme);
  if(btnMobile)  btnMobile.addEventListener('click',  toggleTheme);

  window.addEventListener('resize', () => {
    if(window.innerWidth > 900){
      const m = document.getElementById('mobileMenu');
      if(m) m.classList.remove('open');
    }
  });
})();
</script>
    const target = nowDark ? 'light':'dark';
    apply(target);
    localStorage.setItem(KEY, target);
  });
  window.addEventListener('resize', ()=> {
    if(window.innerWidth > 900){
      const m = document.getElementById('mobileMenu');
      if(m) m.classList.remove('open');
    }
  });
})();
</script>
